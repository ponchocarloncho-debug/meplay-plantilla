<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matthew 4</title>
  <link rel="icon" href="../favicon.ico">
  
  <!-- ========== MYVIDSTER DETECTION TAGS ========== -->
  <!-- Primary thumbnail image (hidden but visible to scrapers) -->
  <link rel="image_src" href="https://s10.picturelol.com/th/74889/ap7nwapxde4v.jpg">
  
  <!-- Open Graph meta tags - Multiple formats for better detection -->
  <meta property="og:title" content="Matthew 4">
  <meta property="og:description" content="‚ñ∂...">
  <meta property="og:image" content="https://s10.picturelol.com/th/74889/ap7nwapxde4v.jpg">
  <meta property="og:image:url" content="https://s10.picturelol.com/th/74889/ap7nwapxde4v.jpg">
  <meta property="og:image:secure_url" content="https://s10.picturelol.com/th/74889/ap7nwapxde4v.jpg">
  <meta property="og:image:type" content="image/jpeg">
  <meta property="og:image:width" content="1280">
  <meta property="og:image:height" content="720">
  <meta property="og:type" content="website">
  <meta property="og:url" content="videos/matthew-4.html">
  
  <!-- Twitter Card - Multiple image references -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Matthew 4">
  <meta name="twitter:description" content="‚ñ∂...">
  <meta name="twitter:image" content="https://s10.picturelol.com/th/74889/ap7nwapxde4v.jpg">
  <meta name="twitter:image:src" content="https://s10.picturelol.com/th/74889/ap7nwapxde4v.jpg">
  
  <!-- Standard meta tags -->
  <meta name="thumbnail" content="https://s10.picturelol.com/th/74889/ap7nwapxde4v.jpg">
  <meta itemprop="image" content="https://s10.picturelol.com/th/74889/ap7nwapxde4v.jpg">
  <meta itemprop="thumbnailUrl" content="https://s10.picturelol.com/th/74889/ap7nwapxde4v.jpg">
  
  <!-- Schema.org structured data for video -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "VideoObject",
    "name": "Matthew 4",
    "description": "‚ñ∂...",
    "thumbnailUrl": "https://s10.picturelol.com/th/74889/ap7nwapxde4v.jpg",
    "uploadDate": "2026-01-01"
  }
  </script>
  
  <!-- Prevent iframe embedding on external sites -->
  <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
  <meta name="referrer" content="no-referrer-when-downgrade">
  
  <!-- Canonical URL to bring traffic back -->
  <link rel="canonical" href="videos/matthew-4.html">
  <!-- ========== END MYVIDSTER TAGS ========== -->
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a1a; color: #fff; }
    
    .navbar { background: #0f0f0f; padding: 15px 30px; position: sticky; top: 0; z-index: 1000; }
    .navbar-container { max-width: 1600px; margin: 0 auto; display: grid; grid-template-columns: 1fr auto 1fr; gap: 20px; align-items: center; }
    .navbar-left { display: flex; justify-content: flex-start; }
    .navbar-center { display: flex; justify-content: center; }
    .navbar-right { display: flex; justify-content: flex-end; }
    
    .logo { height: 60px; cursor: pointer; }
    .nav-btn { background: #2a2a2a; color: #fff; padding: 10px 25px; border: none; border-radius: 5px; text-decoration: none; font-weight: bold; transition: 0.3s; position: relative; }
    .nav-btn:hover { background: #e50914; }
    
    .favorites-badge { position: absolute; top: -5px; right: -5px; background: #e50914; color: white; border-radius: 50%; width: 22px; height: 22px; font-size: 11px; font-weight: bold; display: none; align-items: center; justify-content: center; border: 2px solid #0f0f0f; }
    
    .search-bar { background: #0f0f0f; padding: 15px 30px; }
    .search-container { max-width: 1600px; margin: 0 auto; }
    .search-box { display: flex; gap: 10px; max-width: 600px; margin: 0 auto; position: relative; }
    .search-input { flex: 1; padding: 12px 45px 12px 20px; background: #2a2a2a; border: 2px solid #3a3a3a; border-radius: 8px; color: #fff; font-size: 16px; outline: none; }
    .search-input:focus { border-color: #e50914; }
    .search-clear { position: absolute; right: 140px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #888; font-size: 20px; cursor: pointer; padding: 0 10px; display: none; }
    .search-clear:hover { color: #e50914; }
    .search-clear.show { display: block; }
    .search-btn { padding: 12px 30px; background: #e50914; border: none; border-radius: 8px; color: white; font-size: 16px; font-weight: bold; cursor: pointer; }
    .search-btn:hover { background: #ff0a16; }
    
    .search-results { position: relative; width: 100%; max-width: 1200px; margin: 20px auto 0; background: #2a2a2a; border: 1px solid #3a3a3a; border-radius: 8px; display: none; }
    .search-results.active { display: block; }
    
    .main-container { max-width: 1600px; margin: 0 auto; padding: 30px 20px; display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
    
    .video-section { background: #0f0f0f; border-radius: 8px; padding: 40px; }
    .video-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
    .video-title { font-size: 28px; font-weight: bold; }
    
    .fav-btn { background: #2a2a2a; color: #aaa; border: 2px solid #3a3a3a; padding: 10px 20px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: 0.3s; }
    .fav-btn:hover { background: #3a3a3a; border-color: #e50914; color: #e50914; }
    .fav-btn.active { background: rgba(229, 9, 20, 0.2); border-color: #e50914; color: #e50914; }
    
    .video-player { position: relative; width: 100%; padding-top: 56.25%; background: #000; border-radius: 12px; overflow: hidden; margin-bottom: 40px; }
    
    .video-thumbnail-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .play-btn {
      width: 80px;
      height: 80px;
      background: rgba(229, 9, 20, 0.9);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(229, 9, 20, 0.7);
      }
      50% {
        transform: scale(1.05);
        box-shadow: 0 0 0 20px rgba(229, 9, 20, 0);
      }
    }
    
    .play-btn:hover {
      transform: scale(1.1);
      background: rgba(229, 9, 20, 1);
    }
    
    .play-icon {
      width: 0;
      height: 0;
      border-left: 25px solid white;
      border-top: 15px solid transparent;
      border-bottom: 15px solid transparent;
      margin-left: 5px;
    }
    
    #embedContainer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
    }
    
    #embedContainer.active {
      display: block;
    }
    
    #embedContainer iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    
    .video-desc { color: #ccc; line-height: 1.8; margin-bottom: 25px; }
    
    .gallery { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; }
    .gallery-img { width: 100%; height: 200px; object-fit: cover; border-radius: 8px; }
    .hidden-gallery { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; }
    .show-more-btn { width: 100%; padding: 12px; background: #2a2a2a; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-bottom: 25px; }
    
    .video-tags { display: flex; flex-wrap: wrap; gap: 10px; }
    .tag { background: #2a2a2a; color: #aaa; padding: 8px 16px; border-radius: 6px; cursor: pointer; transition: 0.3s; }
    .tag:hover { background: #e50914; color: white; }
    
    .sidebar { background: #0f0f0f; border-radius: 8px; padding: 15px; }
    .sidebar h3 { font-size: 18px; color: #e50914; margin-bottom: 12px; border-bottom: 2px solid #e50914; padding-bottom: 6px; }
    .sidebar-grid { display: grid !important; grid-template-columns: 1fr 1fr !important; gap: 10px !important; margin-bottom: 25px; }
    .sidebar-item { background: #2a2a2a; border-radius: 8px; overflow: hidden; transition: 0.2s; text-decoration: none; display: block; position: relative; }
    .sidebar-item:hover { transform: scale(1.05); }
    .sidebar-item img { width: 100%; aspect-ratio: 16/9; object-fit: cover; }
    .sidebar-item-title { padding: 8px 10px; font-size: 13px; font-weight: 600; color: #fff; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
    
    .sidebar-fav-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      width: 32px;
      height: 32px;
      background: rgba(42, 42, 42, 0.9);
      border: none;
      border-radius: 50%;
      color: rgba(255, 204, 0, 0.6);
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: 0.3s;
      z-index: 10;
    }
    
    .sidebar-fav-btn:hover {
      background: rgba(229, 9, 20, 0.9);
      color: white;
      transform: scale(1.1);
    }
    
    .sidebar-fav-btn.active {
      background: rgba(229, 9, 20, 0.9);
      color: white;
    }
    
    .load-more-btn { width: 100%; padding: 10px; background: #2a2a2a; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; margin-top: 12px; }
    
    @media (max-width: 1024px) {
      .main-container { grid-template-columns: 1fr; }
    }
    
    @media (max-width: 768px) {
      /* NAVBAR RESPONSIVE */
      .navbar {
        padding: 10px 20px;
      }
      
      .navbar-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }
      
      .navbar-center {
        order: 1;
        width: 100%;
        text-align: center;
      }
      
      .navbar-left, .navbar-right {
        order: 2;
      }
      
      .navbar-left {
        margin-right: 5px;
      }
      
      .navbar-right {
        margin-left: 5px;
      }
      
      /* SEARCH RESPONSIVE */
      .search-bar {
        padding: 10px 15px;
      }
      
      .search-box {
        flex-direction: column;
        gap: 8px;
      }
      
      .search-input {
        width: 100%;
        padding: 10px 40px 10px 15px;
      }
      
      .search-clear {
        right: 10px;
      }
      
      .search-btn {
        width: 100%;
        padding: 10px;
      }
      
      .search-results {
        right: 0;
        left: 0;
        margin: 10px;
      }
      
      /* VIDEO SECTION */
      .video-section { padding: 20px; }
      .video-title { font-size: 22px; }
      .gallery { grid-template-columns: 1fr; }
      .fav-btn { padding: 8px 15px; font-size: 14px; }
    }
    
    /* Toast notifications */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
      color: white;
      padding: 16px 24px;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      gap: 12px;
      z-index: 10000;
      transform: translateX(400px);
      transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      border: 2px solid #3a3a3a;
      max-width: 400px;
    }
    
    .toast.show { transform: translateX(0); }
    .toast-success { border-left: 4px solid #4CAF50; }
    .toast-remove { border-left: 4px solid #e50914; }
    .toast-icon { font-size: 24px; flex-shrink: 0; }
    .toast-message { font-weight: 600; font-size: 15px; }
  </style>
</head>
<body>
  <!-- Hidden thumbnail for scrapers/crawlers (Myvidster detection) -->
  <img src="https://s10.picturelol.com/th/74889/ap7nwapxde4v.jpg" alt="Matthew 4" style="display:none;" id="primary-thumbnail">
  
  <nav class="navbar">
    <div class="navbar-container">
      <div class="navbar-left">
        <a href="../index.html" class="nav-btn">Home</a>
      </div>
      <div class="navbar-center">
        <a href="../index.html"><img src="../logo.png" class="logo" onerror="this.style.display='none'"></a>
      </div>
      <div class="navbar-right">
        <a href="../favorites.html" class="nav-btn">
          Favorites
          <span class="favorites-badge" id="favBadge">0</span>
        </a>
      </div>
    </div>
  </nav>

  <div class="search-bar">
    <div class="search-container">
      <div class="search-box">
        <input type="text" class="search-input" id="searchInput" placeholder="Search...">
        <button class="search-clear" id="searchClear" onclick="clearSearch()">‚úï</button>
        <button class="search-btn" onclick="performSearch()">Search</button>
      </div>
    </div>
    <div class="search-results" id="searchResults"></div>
  </div>

  <div class="main-container">
    <div class="video-section">
      <div class="video-header">
        <h1 class="video-title">Matthew 4</h1>
        <button class="fav-btn" id="favBtn" onclick="toggleFav()">
          <span id="favIcon">‚òÜ</span>
          <span id="favText">Add to Favorites</span>
        </button>
      </div>
      
      <div class="video-player">
        <div class="video-thumbnail-overlay" id="thumbnail-overlay" style="background-image: url('https://s10.picturelol.com/th/74889/ap7nwapxde4v.jpg');">
          <div class="play-btn" onclick="activateVideo()">
            <div class="play-icon"></div>
          </div>
        </div>
        <!-- Empty container - iframe will be created dynamically by JavaScript -->
        <div id="embedContainer"></div>
      </div>
      
      <p class="video-desc">‚ñ∂...</p>
      
      <div class="gallery">
        <img src="https://s10.picturelol.com/th/74889/vc2iod35btwx.jpg" class="gallery-img" loading="lazy">
        <img src="https://s10.picturelol.com/th/74889/fccekwleto00.jpg" class="gallery-img" loading="lazy">
        <img src="https://s10.picturelol.com/th/74889/nq48zwfr9lvs.jpg" class="gallery-img" loading="lazy">
        <img src="https://s10.picturelol.com/th/74889/048rv0tmz0nq.jpg" class="gallery-img" loading="lazy">
        <img src="https://s10.picturelol.com/th/74889/66tmiyh2ottb.jpg" class="gallery-img" loading="lazy">
        <img src="https://s10.picturelol.com/th/74889/53lb7ohmyyp3.jpg" class="gallery-img" loading="lazy">
      </div>
      
      <div class="hidden-gallery" id="hiddenGallery" style="display:none;">
        <img src="https://s10.picturelol.com/th/74889/gu0nvwtjiaoi.jpg" class="gallery-img" loading="lazy">
        <img src="https://s10.picturelol.com/th/74889/zdsynz739bvq.jpg" class="gallery-img" loading="lazy">
      </div>
      <button class="show-more-btn" onclick="toggleGallery()">Show 2 More Images</button>
      
      <div class="video-tags">
      </div>
    </div>
    
    <aside class="sidebar">
      <div id="sidebarContent"></div>
    </aside>
  </div>

  <script src="../widget.js"></script>
  <script>
    const videoId = 'matthew-4';  // Use same format as widget.js: "diego-yoga"
    const videoTitle = 'Matthew 4';
    const encodedEmbed = 'aHR0cHM6Ly9sdWx1dmlkLmNvbS9lL3B3eWs5cndkZXgzdg==';
    
    // Anti-scraping: Detect if being scraped by Myvidster or similar
    function isBeingScraped() {
      // Check if in iframe
      if (window.self !== window.top) {
        return true;
      }
      
      // Check referrer
      const referrer = document.referrer.toLowerCase();
      const blockedReferrers = ['myvidster', 'iframe', 'embed'];
      if (blockedReferrers.some(blocked => referrer.includes(blocked))) {
        return true;
      }
      
      return false;
    }
    
    // If being scraped, redirect to actual page
    if (isBeingScraped()) {
      window.top.location.href = window.location.href;
    }
    
    // Toast notification
    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.innerHTML = `
        <div class="toast-icon">${type === 'success' ? '‚≠ê' : '‚úï'}</div>
        <div class="toast-message">${message}</div>
      `;
      document.body.appendChild(toast);
      
      setTimeout(() => toast.classList.add('show'), 100);
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }
    
    // Update favorites badge
    function updateBadge() {
      const favs = JSON.parse(localStorage.getItem('favorites') || '[]');
      const badge = document.getElementById('favBadge');
      if (favs.length > 0) {
        badge.textContent = favs.length;
        badge.style.display = 'flex';
      } else {
        badge.style.display = 'none';
      }
    }
    
    // Check if current video is favorited
    function checkFav() {
      const favs = JSON.parse(localStorage.getItem('favorites') || '[]');
      const btn = document.getElementById('favBtn');
      const icon = document.getElementById('favIcon');
      const text = document.getElementById('favText');
      
      if (favs.includes(videoId)) {
        btn.classList.add('active');
        icon.textContent = '‚òÖ';
        text.textContent = 'Remove from Favorites';
      } else {
        btn.classList.remove('active');
        icon.textContent = '‚òÜ';
        text.textContent = 'Add to Favorites';
      }
    }
    
    // Toggle favorite
    function toggleFav() {
      let favs = JSON.parse(localStorage.getItem('favorites') || '[]');
      const idx = favs.indexOf(videoId);
      
      let titleShort = videoTitle;
      if (titleShort.length > 40) {
        titleShort = titleShort.substring(0, 40) + '...';
      }
      
      if (idx > -1) {
        favs.splice(idx, 1);
        showToast(`"${titleShort}" removed from favorites`, 'remove');
      } else {
        favs.unshift(videoId);
        showToast(`"${titleShort}" added to favorites!`, 'success');
      }
      
      localStorage.setItem('favorites', JSON.stringify(favs));
      checkFav();
      updateBadge();
    }
    
    // Activate video on play button click - Dynamic iframe creation
    function activateVideo() {
      // Double check not being scraped
      if (isBeingScraped()) {
        alert('Please visit the original page to watch this video.');
        window.top.location.href = window.location.href;
        return;
      }
      
      const overlay = document.getElementById('thumbnail-overlay');
      const container = document.getElementById('embedContainer');
      
      // Decode Base64 URL
      let videoUrl = '';
      try {
        videoUrl = atob(encodedEmbed);
      } catch (e) {
        console.error('Failed to decode video URL');
        return;
      }
      
      // Create iframe dynamically
      const iframe = document.createElement('iframe');
      iframe.setAttribute('src', videoUrl + '?autoplay=1');
      iframe.setAttribute('frameborder', '0');
      iframe.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture');
      iframe.setAttribute('allowfullscreen', 'true');
      iframe.setAttribute('loading', 'lazy');
      iframe.style.width = '100%';
      iframe.style.height = '100%';
      iframe.style.border = 'none';
      
      // Insert iframe into container
      container.appendChild(iframe);
      container.classList.add('active');
      overlay.style.display = 'none';
    }
    
    // Toggle gallery
    function toggleGallery() {
      const hidden = document.getElementById('hiddenGallery');
      const btn = event.target;
      if (hidden.style.display === 'none') {
        hidden.style.display = 'grid';
        btn.textContent = 'Show Less';
      } else {
        hidden.style.display = 'none';
        const count = hidden.querySelectorAll('img').length;
        btn.textContent = 'Show ' + count + ' More Images';
      }
    }
    
    // Search by tag
    function searchByTag(tag) {
      console.log('[TAG] Clicked:', tag);
      const input = document.getElementById('searchInput');
      input.value = tag;
      
      // Wait for showSearchResults to be available
      if (window.showSearchResults) {
        window.showSearchResults(tag);
        // Scroll to results
        setTimeout(() => {
          const results = document.getElementById('searchResults');
          if (results) {
            results.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        }, 100);
      } else {
        console.error('[TAG] showSearchResults not available yet');
        setTimeout(() => searchByTag(tag), 100);
      }
    }
    
    // Export searchByTag globally
    window.searchByTag = searchByTag;
    
    function performSearch() {
      const query = document.getElementById('searchInput').value;
      if (query && window.showSearchResults) {
        window.showSearchResults(query);
      }
    }
    
    function clearSearch() {
      document.getElementById('searchInput').value = '';
      document.getElementById('searchResults').classList.remove('active');
      document.getElementById('searchClear').classList.remove('show');
    }
    
    // Load sidebar
    let currentSidebarRecentsPage = 1;
    const SIDEBAR_RECENTS_PER_LOAD = 4;
    
    function loadSidebar() {
      if (!window.videosData || !window.getRandomVideos) {
        setTimeout(loadSidebar, 100);
        return;
      }
      
      const random = window.getRandomVideos(10, videoId);
      
      let html = '<h3>üé≤ Random</h3><div class="sidebar-grid">';
      random.forEach(v => {
        const img = v.images && v.images.length > 0 ? v.images[0] : v.thumbnail;
        const url = v.url.replace('videos/', '');
        const vId = v.url.split('/').pop().replace('.html', ''); // Same format as widget.js
        const isFav = JSON.parse(localStorage.getItem('favorites') || '[]').includes(vId);
        html += `<div style="position: relative;">
          <a href="${url}" class="sidebar-item">
            <img src="${img}" loading="lazy">
            <div class="sidebar-item-title">${v.title}</div>
          </a>
          <button class="sidebar-fav-btn ${isFav ? 'active' : ''}" onclick="toggleSidebarFav(event, '${vId}', '${v.title}')">
            ${isFav ? '‚òÖ' : '‚òÜ'}
          </button>
        </div>`;
      });
      html += '</div>';
      
      document.getElementById('sidebarContent').innerHTML = html;
      
      // Load initial recents
      loadSidebarRecents();
    }
    
    function loadSidebarRecents() {
      if (!window.videosData || !window.getRecentVideos) return;
      
      const allRecents = window.getRecentVideos(100); // Get more than we need
      const totalToShow = currentSidebarRecentsPage * SIDEBAR_RECENTS_PER_LOAD;
      const recentsToShow = allRecents.slice(0, totalToShow);
      const hasMore = allRecents.length > totalToShow;
      
      let html = '<h3>üïí Recents</h3><div class="sidebar-grid" id="recentsGrid">';
      recentsToShow.forEach(v => {
        const img = v.images && v.images.length > 0 ? v.images[0] : v.thumbnail;
        const url = v.url.replace('videos/', '');
        const vId = v.url.split('/').pop().replace('.html', ''); // Same format as widget.js
        const isFav = JSON.parse(localStorage.getItem('favorites') || '[]').includes(vId);
        html += `<div style="position: relative;">
          <a href="${url}" class="sidebar-item">
            <img src="${img}" loading="lazy">
            <div class="sidebar-item-title">${v.title}</div>
          </a>
          <button class="sidebar-fav-btn ${isFav ? 'active' : ''}" onclick="toggleSidebarFav(event, '${vId}', '${v.title}')">
            ${isFav ? '‚òÖ' : '‚òÜ'}
          </button>
        </div>`;
      });
      html += '</div>';
      
      if (hasMore) {
        html += '<button class="load-more-btn" onclick="loadMoreSidebarRecents()">Load more recents</button>';
      }
      
      const container = document.getElementById('sidebarContent');
      const randomSection = container.querySelector('h3').parentElement || container.innerHTML;
      container.innerHTML = container.innerHTML.split('<h3>üïí Recents</h3>')[0] + html;
    }
    
    function loadMoreSidebarRecents() {
      currentSidebarRecentsPage++;
      loadSidebarRecents();
    }
    
    window.loadMoreSidebarRecents = loadMoreSidebarRecents;
    
    // Toggle favorite from sidebar
    function toggleSidebarFav(event, videoUrl, videoTitle) {
      event.preventDefault();
      event.stopPropagation();
      
      console.log('[SIDEBAR FAV] videoUrl:', videoUrl);
      
      let favs = JSON.parse(localStorage.getItem('favorites') || '[]');
      const idx = favs.indexOf(videoUrl);
      
      console.log('[SIDEBAR FAV] Current favs:', favs);
      console.log('[SIDEBAR FAV] Index:', idx);
      
      let titleShort = videoTitle;
      if (titleShort.length > 40) {
        titleShort = titleShort.substring(0, 40) + '...';
      }
      
      const wasInFavorites = idx > -1;
      
      if (wasInFavorites) {
        favs.splice(idx, 1);
        showToast(`"${titleShort}" removed from favorites`, 'remove');
      } else {
        favs.unshift(videoUrl);
        showToast(`"${titleShort}" added to favorites!`, 'success');
      }
      
      localStorage.setItem('favorites', JSON.stringify(favs));
      console.log('[SIDEBAR FAV] Updated favs:', JSON.parse(localStorage.getItem('favorites')));
      updateBadge();
      
      // Update button - fix the logic
      const btn = event.target;
      if (wasInFavorites) {
        btn.classList.remove('active');
        btn.textContent = '‚òÜ';
      } else {
        btn.classList.add('active');
        btn.textContent = '‚òÖ';
      }
      
      console.log('[SIDEBAR FAV] Button updated, wasInFavorites:', wasInFavorites);
    }
    
    window.toggleSidebarFav = toggleSidebarFav;
    
    // Search results - DEFINE THIS FIRST before searchByTag uses it
    window.showSearchResults = function(query) {
      console.log('[SEARCH] Searching for:', query);
      const results = document.getElementById('searchResults');
      if (!window.videosData) {
        results.innerHTML = '<div style="padding: 40px; text-align: center; color: #888;">Loading...</div>';
        results.classList.add('active');
        return;
      }
      
      const q = query.toLowerCase();
      const matches = window.videosData.filter(v => 
        v.title.toLowerCase().includes(q) || 
        (v.description && v.description.toLowerCase().includes(q)) ||
        (v.tags && v.tags.some(t => t.toLowerCase().includes(q)))
      );
      
      console.log('[SEARCH] Found', matches.length, 'results');
      
      if (matches.length === 0) {
        results.innerHTML = '<div style="padding: 40px; text-align: center; color: #888;">No results for "' + query + '"</div>';
        results.classList.add('active');
        return;
      }
      
      let html = '<div style="padding: 20px; background: #1a1a1a; border-bottom: 2px solid #e50914;"><strong style="color: #e50914; font-size: 20px;">üîç Found ' + matches.length + ' results</strong></div>';
      html += '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; padding: 20px;">';
      matches.slice(0, 16).forEach(v => {
        const img = v.images && v.images.length > 0 ? v.images[0] : v.thumbnail;
        const url = v.url.replace('videos/', '');
        html += `<div onclick="location.href='${url}'" style="cursor: pointer; background: #1a1a1a; border-radius: 8px; overflow: hidden;">
          <img src="${img}" style="width: 100%; aspect-ratio: 16/9; object-fit: cover;">
          <div style="padding: 15px;"><strong>${v.title}</strong></div>
        </div>`;
      });
      html += '</div>';
      if (matches.length > 16) {
        html += '<div style="padding: 20px; text-align: center; color: #888;">+' + (matches.length - 16) + ' more</div>';
      }
      results.innerHTML = html;
      results.classList.add('active');
    };
    
    // Initialize
    updateBadge();
    checkFav();
    loadSidebar();
    setInterval(updateBadge, 500);
    
    // Search input listener
    document.getElementById('searchInput').addEventListener('input', function() {
      const query = this.value.trim();
      const clearBtn = document.getElementById('searchClear');
      
      // Show/hide clear button
      if (query.length > 0) {
        clearBtn.classList.add('show');
      } else {
        clearBtn.classList.remove('show');
      }
      
      if (query.length > 2) {
        if (window.showSearchResults) {
          window.showSearchResults(query);
        }
      } else {
        document.getElementById('searchResults').classList.remove('active');
      }
    });
    
    document.addEventListener('click', e => {
      if (!e.target.closest('.search-box') && !e.target.closest('.search-results')) {
        document.getElementById('searchResults').classList.remove('active');
      }
    });
    
    document.getElementById('searchInput').addEventListener('keypress', e => {
      if (e.key === 'Enter') performSearch();
    });
  </script>
</body>
</html>